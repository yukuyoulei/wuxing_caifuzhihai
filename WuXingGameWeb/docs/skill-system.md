# 技能系统详细说明

## 概述

技能系统是五行探险记 v1.3.0 版本新增的核心功能，为每个五行元素提供可升级的技能，让玩家可以通过消耗资源来增强战斗能力。

## 技能结构

### 基本信息
- **技能数量**：5 个（对应五行元素：金、木、水、火、土）
- **升级方向**：每个技能有两个独立的升级路径
  - 阴属性（Yin）：增强克制效果
  - 阳属性（Yang）：减免被克制效果
- **等级范围**：从 0 级开始，理论上可以无限升级

## 技能效果

### 阴属性技能（克制加成）

**作用**：当你的元素克制对手元素时，增强减少对手数量的效果

**计算公式**：
```
减少率 = 基础减少率 + (阴属性等级 × 5%)
基础减少率 = 50%
```

**效果示例**：
- 0 级：减少对手 50%
- 1 级：减少对手 55%
- 2 级：减少对手 60%
- 3 级：减少对手 65%
- 5 级：减少对手 75%
- 10 级：减少对手 100%（完全抵消）

### 阳属性技能（抗性加成）

**作用**：当你的元素被对手克制时，减少对手数量增加的效果

**计算公式**：
```
增加倍数 = 基础增加倍数 - (阳属性等级 × 10%)
基础增加倍数 = 200%
最低倍数 = 100%（不会低于原始数量）
```

**效果示例**：
- 0 级：对手增加 200%
- 1 级：对手增加 190%
- 2 级：对手增加 180%
- 3 级：对手增加 170%
- 5 级：对手增加 150%
- 10 级：对手增加 100%（完全抵消克制效果）

## 升级成本

### 成本计算公式

**元素消耗**：
```
元素成本 = 10 + (当前等级 × 5)
```

**货币消耗**：
```
货币成本 = 3 + (当前等级 × 2)
```

### 成本示例表

| 当前等级 | 元素成本 | 货币成本 |
|---------|---------|---------|
| 0 → 1   | 10      | 3       |
| 1 → 2   | 15      | 5       |
| 2 → 3   | 20      | 7       |
| 3 → 4   | 25      | 9       |
| 4 → 5   | 30      | 11      |
| 5 → 6   | 35      | 13      |
| 9 → 10  | 55      | 21      |

### 货币类型要求
- **升级阴属性**：需要消耗阴货币
- **升级阳属性**：需要消耗阳货币

## 战斗机制集成

### 克制效果应用

技能效果会自动应用到战斗计算中：

1. **玩家选择元素**
2. **揭示对手元素**
3. **判断克制关系**
4. **应用技能效果**：
   - 如果克制：使用阴属性技能计算减少率
   - 如果被克制：使用阳属性技能计算增加倍数
   - 如果平局：不应用技能效果
5. **计算最终对手数量**
6. **比较数量判定胜负**

### 示例战斗

**场景**：玩家使用金元素（20个），对手是木元素（30个）

**无技能**：
- 金克木，对手减少 50%
- 对手最终数量：30 × 50% = 15
- 玩家 20 > 对手 15，玩家胜利

**阴属性 3 级**：
- 金克木，对手减少 65%（50% + 3×5%）
- 对手最终数量：30 × 35% = 10.5 → 10
- 玩家 20 > 对手 10，玩家胜利（优势更大）

**场景**：玩家使用木元素（15个），对手是金元素（10个）

**无技能**：
- 木被金克，对手增加 200%
- 对手最终数量：10 × 200% = 20
- 玩家 15 < 对手 20，玩家失败

**阳属性 5 级**：
- 木被金克，对手增加 150%（200% - 5×10%）
- 对手最终数量：10 × 150% = 15
- 玩家 15 = 对手 15，玩家失败（但差距缩小）

## 策略建议

### 升级优先级

1. **常用元素优先**
   - 优先升级你最常使用的元素技能
   - 根据战斗记录分析哪些元素使用频率最高

2. **平衡发展**
   - 避免只升级一两个元素
   - 保持五种元素技能的相对平衡

3. **根据战斗风格选择**
   - **进攻型玩家**：优先升级阴属性，最大化克制优势
   - **防守型玩家**：优先升级阳属性，减少被克制损失
   - **平衡型玩家**：阴阳属性同步升级

### 资源分配

1. **货币管理**
   - 不要把所有货币都用于升级技能
   - 保留一定货币用于战斗失败时的扭转
   - 建议保留至少 20-30 个阴阳货币作为应急

2. **元素管理**
   - 升级技能会消耗大量元素
   - 确保升级后仍有足够元素进行战斗
   - 建议在元素充足时（>30个）再考虑升级

3. **长期规划**
   - 早期：专注积累资源，少量升级
   - 中期：选择1-2个主力元素重点升级
   - 后期：全面提升所有元素技能

### 升级时机

**最佳升级时机**：
- 在出生点，元素和货币都充足时
- 刚完成一次成功的远征，获得大量资源后
- 准备进行长距离探险前，提升战斗能力

**避免升级时机**：
- 元素或货币不足时
- 正在战斗中
- 距离出生点很远，资源紧张时

## 技术实现

### 数据结构

```typescript
interface Skill {
  element: ElementType;
  yinLevel: number;
  yangLevel: number;
}

interface SkillSet {
  [ElementType.METAL]: Skill;
  [ElementType.WOOD]: Skill;
  [ElementType.WATER]: Skill;
  [ElementType.FIRE]: Skill;
  [ElementType.EARTH]: Skill;
}
```

### 核心函数

1. **initializeSkills()**: 初始化所有技能为 0 级
2. **calculateSkillUpgradeCost(level)**: 计算升级成本
3. **calculateCounterEffect(skill, isCountering)**: 计算克制效果
4. **applyCounterEffect(quantity, playerElement, opponentElement, skills)**: 应用技能效果到战斗
5. **upgradeSkill(element, upgradeType)**: 执行技能升级

### 数据持久化

- 技能数据自动保存到 localStorage
- 与游戏其他状态一起保存
- 重置游戏时会清空所有技能等级

## UI 说明

### 技能面板位置
- 位于游戏主界面底部
- 在战斗区域和操作控制面板下方

### 技能卡片内容
- 元素图标和名称
- 阴属性等级和当前效果
- 阳属性等级和当前效果
- 升级按钮（显示成本）
- 资源不足时按钮禁用

### 交互方式
- 点击"升级"按钮执行升级
- 升级成功后显示提示信息
- 资源不足时显示错误提示

## 常见问题

**Q: 技能等级有上限吗？**
A: 理论上没有上限，但成本会随等级增加，实际上受资源限制。

**Q: 技能效果会叠加吗？**
A: 不会。每次战斗只应用当前使用元素的技能效果。

**Q: 可以降级技能吗？**
A: 不可以。技能只能升级，不能降级或重置（除非重置整个游戏）。

**Q: 升级技能会消耗战斗用的元素吗？**
A: 是的。升级技能需要消耗对应元素，所以要确保升级后仍有足够元素战斗。

**Q: 阴阳属性可以同时升级吗？**
A: 可以。两个属性是独立的，可以分别升级。

**Q: 技能效果在什么时候生效？**
A: 在战斗中自动生效，不需要手动激活。

## 更新历史

- **v1.3.0** (2025-12-15): 技能系统首次发布
  - 实现基础技能系统
  - 添加阴阳双属性升级路径
  - 集成到战斗系统
  - 完整的UI界面
